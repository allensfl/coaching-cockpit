<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KI Coaching Session - KI Online Coach</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="chat-container">
        <!-- Sidebar -->
        <div class="chat-sidebar">
            <div class="chat-header">
                <div class="coach-info">
                    <div class="coach-avatar">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="coach-details">
                        <h3>KI Coach</h3>
                        <p>Dein persönlicher Coaching-Assistent</p>
                        <div class="online-status">
                            <span class="status-dot"></span>
                            Online
                        </div>
                    </div>
                </div>
                
                <!-- Phase Indicator -->
                <div class="phase-indicator">
                    <div class="phase-ring" id="phaseRing">
                        <div class="phase-number" id="phaseNumber">1</div>
                    </div>
                    <div class="phase-info">
                        <h4 id="phaseName">Vertrauensaufbau</h4>
                        <p id="phaseDescription">Wir lernen uns kennen und schaffen eine vertrauensvolle Basis</p>
                    </div>
                </div>

                <!-- Progress Overview -->
                <div class="progress-overview">
                    <h4>Dein Fortschritt</h4>
                    <div class="overall-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="overallProgress" style="width: 12.5%"></div>
                        </div>
                        <span>Phase 1 von 8</span>
                    </div>
                </div>

                <!-- Phase Navigation -->
                <div class="phase-navigation">
                    <h4>Coaching-Phasen</h4>
                    <div class="phases-list">
                        <div class="phase-item active" data-phase="1">
                            <span class="phase-dot completed"></span>
                            <span>Vertrauensaufbau</span>
                            <i class="fas fa-handshake"></i>
                        </div>
                        <div class="phase-item" data-phase="2">
                            <span class="phase-dot"></span>
                            <span>Zielsetzung</span>
                            <i class="fas fa-target"></i>
                        </div>
                        <div class="phase-item" data-phase="3">
                            <span class="phase-dot"></span>
                            <span>Ist-Analyse</span>
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="phase-item" data-phase="4">
                            <span class="phase-dot"></span>
                            <span>Ressourcen</span>
                            <i class="fas fa-gem"></i>
                        </div>
                        <div class="phase-item" data-phase="5">
                            <span class="phase-dot"></span>
                            <span>Strategien</span>
                            <i class="fas fa-chess"></i>
                        </div>
                        <div class="phase-item" data-phase="6">
                            <span class="phase-dot"></span>
                            <span>Umsetzung</span>
                            <i class="fas fa-rocket"></i>
                        </div>
                        <div class="phase-item" data-phase="7">
                            <span class="phase-dot"></span>
                            <span>Reflexion</span>
                            <i class="fas fa-mirror"></i>
                        </div>
                        <div class="phase-item" data-phase="8">
                            <span class="phase-dot"></span>
                            <span>Abschluss</span>
                            <i class="fas fa-flag-checkered"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chat-main">
            <!-- Chat Header -->
            <div class="chat-main-header">
                <div class="session-info">
                    <h2>Coaching Session</h2>
                    <p>Phase 1: Vertrauensaufbau • <span id="sessionTime">0:00</span></p>
                </div>
                <div class="chat-actions">
                    <button class="btn-icon" onclick="toggleLearningStyle()" title="Lernstil anpassen">
                        <i class="fas fa-brain"></i>
                    </button>
                    <button class="btn-icon" onclick="showSessionSummary()" title="Session-Zusammenfassung">
                        <i class="fas fa-file-alt"></i>
                    </button>
                    <button class="btn-icon" onclick="endSession()" title="Session beenden">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- Messages Container -->
            <div class="messages-container" id="messagesContainer">
                <div class="message ai">
                    <div class="message-avatar">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="message-content">
                        <p>Hallo! 👋 Ich bin dein KI-Coach und freue mich darauf, dich in den nächsten 8 Phasen zu begleiten.</p>
                        <p>Wir starten mit dem <strong>Vertrauensaufbau</strong>. Erzähl mir gerne etwas über dich - was beschäftigt dich gerade?</p>
                        <div class="message-time">Gerade eben</div>
                    </div>
                </div>
            </div>

            <!-- Quick Responses -->
            <div class="quick-responses" id="quickResponses">
                <button class="quick-response-btn" onclick="sendQuickResponse('Ich bin neu hier und etwas nervös.')">
                    😊 Ich bin neu hier und etwas nervös
                </button>
                <button class="quick-response-btn" onclick="sendQuickResponse('Erzähl mir mehr über den Coaching-Prozess.')">
                    🤔 Erzähl mir mehr über den Prozess
                </button>
                <button class="quick-response-btn" onclick="sendQuickResponse('Ich habe konkrete Ziele, die ich erreichen möchte.')">
                    🎯 Ich habe konkrete Ziele
                </button>
            </div>

            <!-- Chat Input -->
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea 
                        id="chatInput" 
                        class="chat-input" 
                        placeholder="Schreibe deine Nachricht..."
                        rows="1"
                        onkeydown="handleKeyDown(event)"
                        oninput="autoResize(this)"
                    ></textarea>
                    <button id="sendBtn" class="send-btn" onclick="sendMessage()" disabled>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="input-hints">
                    <small><i class="fas fa-lightbulb"></i> Sei ehrlich und offen - je mehr du teilst, desto besser kann ich dir helfen!</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Learning Style Modal -->
    <div id="learningStyleModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Lernstil anpassen</h3>
                <button class="modal-close" onclick="closeModal('learningStyleModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Wie lernst du am besten? Ich passe meine Antworten an deinen Stil an:</p>
                <div class="learning-styles">
                    <button class="learning-style-btn" data-style="visual" onclick="setLearningStyle('visual')">
                        <i class="fas fa-eye"></i>
                        <strong>Visuell</strong>
                        <span>Bilder, Diagramme, Visualisierungen</span>
                    </button>
                    <button class="learning-style-btn" data-style="auditory" onclick="setLearningStyle('auditory')">
                        <i class="fas fa-volume-up"></i>
                        <strong>Auditiv</strong>
                        <span>Gespräche, Geschichten, Audio</span>
                    </button>
                    <button class="learning-style-btn" data-style="kinesthetic" onclick="setLearningStyle('kinesthetic')">
                        <i class="fas fa-hand-paper"></i>
                        <strong>Kinästhetisch</strong>
                        <span>Praktische Übungen, Bewegung</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Summary Modal -->
    <div id="sessionSummaryModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Session-Zusammenfassung</h3>
                <button class="modal-close" onclick="closeModal('sessionSummaryModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="summary-section">
                    <h4>Aktuelle Phase</h4>
                    <p><strong>Phase 1: Vertrauensaufbau</strong></p>
                    <p>Du befindest dich in der ersten Phase des Coaching-Prozesses.</p>
                </div>
                <div class="summary-section">
                    <h4>Wichtige Erkenntnisse</h4>
                    <ul id="summaryInsights">
                        <li>Session gestartet</li>
                    </ul>
                </div>
                <div class="summary-section">
                    <h4>Nächste Schritte</h4>
                    <ul>
                        <li>Vertrauen weiter aufbauen</li>
                        <li>Offene Kommunikation fördern</li>
                        <li>Zur Zielsetzung überleiten</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global State
        let currentPhase = 1;
        let sessionStartTime = Date.now();
        let messageCount = 0;
        let learningStyle = 'mixed';
        let sessionInsights = ['Session gestartet'];

        // Phase Definitions
        const phases = {
            1: { name: "Vertrauensaufbau", icon: "🤝", description: "Wir lernen uns kennen und schaffen eine vertrauensvolle Basis" },
            2: { name: "Zielsetzung", icon: "🎯", description: "Wir definieren deine konkreten Ziele und Wünsche" },
            3: { name: "Ist-Analyse", icon: "📊", description: "Wir schauen uns deine aktuelle Situation genau an" },
            4: { name: "Ressourcen", icon: "💎", description: "Wir entdecken deine Stärken und verfügbaren Mittel" },
            5: { name: "Strategien", icon: "♟️", description: "Wir entwickeln konkrete Handlungsstrategien" },
            6: { name: "Umsetzung", icon: "🚀", description: "Wir planen die praktische Umsetzung" },
            7: { name: "Reflexion", icon: "🪞", description: "Wir reflektieren den Fortschritt und passen an" },
            8: { name: "Abschluss", icon: "🏁", description: "Wir fassen zusammen und planen die Zukunft" }
        };

        // Session Timer
        function updateSessionTime() {
            const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('sessionTime').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Message Handling
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            // Add user message
            addMessage(message, 'user');
            input.value = '';
            autoResize(input);
            updateSendButton();

            // Simulate AI response
            setTimeout(() => {
                const aiResponse = generateAIResponse(message);
                addMessage(aiResponse, 'ai');
                messageCount++;
                
                // Check for phase advancement
                if (messageCount >= 4 && currentPhase < 8) {
                    setTimeout(() => advancePhase(), 2000);
                }
            }, 1000 + Math.random() * 2000);
        }

        function sendQuickResponse(message) {
            addMessage(message, 'user');
            
            setTimeout(() => {
                const aiResponse = generateAIResponse(message);
                addMessage(aiResponse, 'ai');
            }, 800);
        }

        function addMessage(content, sender) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString('de-DE', {
                hour: '2-digit',
                minute: '2-digit'
            });

            messageDiv.innerHTML = `
                <div class="message-avatar">
                    ${sender === 'ai' ? '<i class="fas fa-brain"></i>' : '<i class="fas fa-user"></i>'}
                </div>
                <div class="message-content">
                    <p>${content}</p>
                    <div class="message-time">${time}</div>
                </div>
            `;

            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;

            // Update quick responses based on phase
            if (sender === 'ai') {
                updateQuickResponses();
            }
        }

        function generateAIResponse(userMessage) {
            const responses = {
                1: [
                    "Das kann ich gut verstehen. Vertrauen ist die Basis für erfolgreiches Coaching. Magst du mir erzählen, was dich hierher geführt hat?",
                    "Danke, dass du das mit mir teilst. Ich bin hier, um dich zu unterstützen. Was ist dein wichtigstes Anliegen?",
                    "Das klingt sehr wichtig für dich. Lass uns gemeinsam schauen, wie wir das angehen können."
                ],
                2: [
                    "Perfekt, lass uns deine Ziele konkretisieren. Was möchtest du in den nächsten 3-6 Monaten erreichen?",
                    "Ziele sind der Kompass für unsere Reise. Beschreibe mir dein ideales Ergebnis.",
                    "Sehr gut! Je klarer deine Ziele, desto gezielter können wir arbeiten."
                ]
            };

            const phaseResponses = responses[currentPhase] || responses[1];
            const response = phaseResponses[Math.floor(Math.random() * phaseResponses.length)];
            
            // Adapt to learning style
            return adaptToLearningStyle(response);
        }

        function adaptToLearningStyle(response) {
            const adaptations = {
                visual: " 📊 Kannst du dir das bildlich vorstellen?",
                auditory: " 🎧 Wie klingt das für dich?",
                kinesthetic: " 🏃‍♂️ Was wäre dein erster praktischer Schritt?"
            };

            if (learningStyle !== 'mixed' && Math.random() > 0.5) {
                response += adaptations[learningStyle];
            }

            return response;
        }

        function updateQuickResponses() {
            const quickResponsesData = {
                1: [
                    "Ich fühle mich wohler und bin bereit für den nächsten Schritt",
                    "Erzähl mir mehr über die nächste Phase",
                    "Ich habe noch Fragen zum Prozess"
                ],
                2: [
                    "Mein Hauptziel ist berufliche Veränderung",
                    "Ich möchte an meiner Work-Life-Balance arbeiten",
                    "Wie kann ich meine Ziele konkretisieren?"
                ]
            };

            const container = document.getElementById('quickResponses');
            const responses = quickResponsesData[currentPhase] || quickResponsesData[1];
            
            container.innerHTML = responses.map(response => 
                `<button class="quick-response-btn" onclick="sendQuickResponse('${response}')">
                    ${response}
                </button>`
            ).join('');
        }

        // Phase Management
        function advancePhase() {
            if (currentPhase >= 8) return;
            
            currentPhase++;
            updatePhaseUI();
            
            const phaseData = phases[currentPhase];
            addMessage(`🎉 Großartig! Wir gehen zur nächsten Phase über: **${phaseData.name}**\n\n${phaseData.description}`, 'ai');
            
            sessionInsights.push(`Phase ${currentPhase} erreicht: ${phaseData.name}`);
            messageCount = 0;
        }

        function updatePhaseUI() {
            const phaseNumber = document.getElementById('phaseNumber');
            const phaseName = document.getElementById('phaseName');
            const phaseDescription = document.getElementById('phaseDescription');
            const overallProgress = document.getElementById('overallProgress');
            const phaseRing = document.getElementById('phaseRing');

            const phaseData = phases[currentPhase];
            
            phaseNumber.textContent = currentPhase;
            phaseName.textContent = phaseData.name;
            phaseDescription.textContent = phaseData.description;
            
            const progressPercentage = (currentPhase / 8) * 100;
            overallProgress.style.width = `${progressPercentage}%`;
            
            // Update phase ring
            const ringProgress = (currentPhase / 8) * 360;
            phaseRing.style.background = `conic-gradient(#4F46E5 ${ringProgress}deg, #E5E7EB ${ringProgress}deg)`;

            // Update phase navigation
            document.querySelectorAll('.phase-item').forEach((item, index) => {
                const phaseNum = index + 1;
                item.classList.toggle('active', phaseNum === currentPhase);
                item.classList.toggle('completed', phaseNum < currentPhase);
                
                const dot = item.querySelector('.phase-dot');
                dot.classList.toggle('completed', phaseNum <= currentPhase);
            });
        }

        // UI Functions
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
            updateSendButton();
        }

        function updateSendButton() {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = !input.value.trim();
        }

        function toggleLearningStyle() {
            toggleModal('learningStyleModal');
        }

        function setLearningStyle(style) {
            learningStyle = style;
            document.querySelectorAll('.learning-style-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.style === style);
            });
            
            addMessage(`Lernstil auf "${style}" eingestellt. Ich passe meine Antworten entsprechend an! 🧠`, 'ai');
            closeModal('learningStyleModal');
        }

        function showSessionSummary() {
            updateSessionSummary();
            toggleModal('sessionSummaryModal');
        }

        function updateSessionSummary() {
            const insightsList = document.getElementById('summaryInsights');
            insightsList.innerHTML = sessionInsights.map(insight => `<li>${insight}</li>`).join('');
        }

        function endSession() {
            if (confirm('Möchtest du die Session wirklich beenden?')) {
                window.location.href = 'index.html';
            }
        }

        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.toggle('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Authentication check
            const userRole = sessionStorage.getItem('userRole');
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            
            if (!isLoggedIn || userRole !== 'client') {
                window.location.href = 'index.html';
                return;
            }

            // Start session timer
            setInterval(updateSessionTime, 1000);
            
            // Initialize UI
            updatePhaseUI();
            updateQuickResponses();
            
            // Enable input
            document.getElementById('chatInput').addEventListener('input', updateSendButton);
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
